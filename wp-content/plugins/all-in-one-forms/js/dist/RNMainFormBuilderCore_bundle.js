rndefine("#RNMainFormBuilderCore",["#RNMainCoreUI/ModelBase","#RNMainCoreUI/ModelWithParent","lit","#RNMainCore/StoreBase","#RNMainCore/EventManager","#RNMainDialog/Dialog","#RNMainCore/WpAjaxPost","#RNMainCore/SingleEvent","#RNMainDialog/DialogBase","lit/decorators","#RNMainCore/LitElementBase","#RNMainLit/Lit","#RNMainCore/Sanitizer","lit/directives/repeat.js","#RNMainCoreUI/LitModel"],(function(e,t,i,s,r,n,l,a,o,u,d,c,h,p,m){"use strict";var f,b,y;let g=(f=e.ModelSerialize("Field"),b=class extends t.ModelWithParent{constructor(e,t){super(e,t),babelHelpers.initializerDefineProperty(this,"_field",y,this),null!=this.FormBuilder&&null!=this.Options.Field&&(this.Field=this.FormBuilder.CreateFieldModel(this.Options.Field),this.Field.Parent=this)}render(){return i.html`<rn-fbcolumn .model="${this}"></rn-fbcolumn>`}get RootFormBuilder(){return this.Parent.RootFormBuilder}get FormBuilder(){return this.Parent.FormBuilder}get Field(){return this._field}set Field(e){this._field=e,null!=e&&(e.Parent=this)}},y=babelHelpers.applyDecoratedDescriptor(b.prototype,"_field",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),b);var I,F,P;let C=(I=s.StoreAutoIncrement("FBColumn"),F=class extends s.StoreBase{constructor(...e){super(...e),babelHelpers.initializerDefineProperty(this,"Id",P,this)}LoadDefaultValues(){this.Id=0,this.WidthPercentage=100,this.Field=null}GetValueFromLoader(e,t){switch(e){case"Field":return class{static GetFieldOptions(e){let t=r.EventManager.Publish("GetFieldOptions",e.Type);return null==t?null:(t.Merge(e),t)}}.GetFieldOptions(t);default:return null}}},P=babelHelpers.applyDecoratedDescriptor(F.prototype,"Id",[I],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),F);var v,S,x;let O=(v=e.ModelSerialize(),S=class extends t.ModelWithParent{constructor(e,t){super(e,t),babelHelpers.initializerDefineProperty(this,"Columns",x,this);for(let e of this.Options.Columns)this.Columns.push(new g(e,this))}render(){return i.html`<rn-fbrow .model=${this}></rn-fbrow>`}get RootFormBuilder(){return this.Parent.RootFormBuilder}get FormBuilder(){return this.Parent}AddColumn(e,t=0){e.Parent=this,this.Columns.splice(t,0,e)}InsertColumn(e,t=0){e.Parent=this,this.Columns.splice(t,0,e)}CreateColumn(e,t=null){let i=new g((new C).Merge(e),this);return i.Parent=this,null!==t&&this.InsertColumn(i,t),i}},x=babelHelpers.applyDecoratedDescriptor(S.prototype,"Columns",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),S);var T,w,E,D,_,G,R,$,V,M,z,B,N,L,U,A,H;let k,Q,W;!function(e){e.Equal="Equal",e.NotEqual="NotEqual",e.IsEmpty="IsEmpty",e.IsNotEmpty="IsNotEmpty",e.None="None",e.Contains="Contains",e.NotContains="NotContains",e.ChangedTo="ChangedTo",e.ChangedFrom="ChangedFrom",e.GreaterThan="GreaterThan",e.GreaterOrEqualThan="GreaterOrEqualThan",e.LessThan="LessThan",e.LessOrEqualThan="LessOrEqualThan",e.IsChecked="IsChecked",e.IsNotChecked="IsNotChecked",e.WasClicked="WasClicked",e.IsGuest="IsGuest",e.IsNotGuest="IsNotGuest",e.ViewingPage="ViewingPage",e.Is="Is",e.IsNot="IsNot",e.IsPartOfRole="IsPartOfRole",e.IsNotPartOfRole="IsNotPartOfRole"}(k||(k={})),function(e){e.Standard="Standard",e.Text="Text",e.MultipleValues="MultipleValues",e.Composed="Composed",e.Date="Date",e.Numeric="Numeric",e.Checkbox="Checkbox",e.Button="Button",e.Status="Status",e.Role="Role",e.Survey="Survey",e.List="List"}(Q||(Q={})),function(e){e.Variation="Variation",e.None="None",e.Entry="Entry",e.Field="Field"}(W||(W={}));let q,j=(T=s.StoreDataType(Object),w=s.StoreAutoIncrement("ConditionLineOptions"),E=class extends s.StoreBase{constructor(...e){super(...e),babelHelpers.initializerDefineProperty(this,"Value",D,this),babelHelpers.initializerDefineProperty(this,"Id",_,this)}LoadDefaultValues(){this.Id=0,this.FieldId="",this.Comparison=k.None,this.Value="",this.Type=W.None,this.SubType=Q.Standard,this.ValueSubType="",this.PathId=""}GetValueFromLoader(e,t){switch(e){case"Value":return class{static GetValue(e,t){if(e.SubType==Q.MultipleValues)return""!=t&&Array.isArray(t)?t:[]}}.GetValue(this,t);default:return null}}},D=babelHelpers.applyDecoratedDescriptor(E.prototype,"Value",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_=babelHelpers.applyDecoratedDescriptor(E.prototype,"Id",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),E),Y=(G=s.StoreAutoIncrement("ConditionGroupOptions"),R=s.StoreDataType(j),$=class extends s.StoreBase{constructor(...e){super(...e),babelHelpers.initializerDefineProperty(this,"Id",V,this),babelHelpers.initializerDefineProperty(this,"ConditionLines",M,this)}LoadDefaultValues(){this.ConditionLines=[],this.Id=0}},V=babelHelpers.applyDecoratedDescriptor($.prototype,"Id",[G],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),M=babelHelpers.applyDecoratedDescriptor($.prototype,"ConditionLines",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$);!function(e){e.Field="Field"}(q||(q={}));class Z extends s.StoreBase{LoadDefaultValues(){this.Type=q.Field,this.Id=""}}let J=(z=s.StoreAutoIncrement("ConditionOptionsBase"),B=s.StoreDataType(Y),N=s.StoreDataType(Z),L=class extends s.StoreBase{constructor(...e){super(...e),babelHelpers.initializerDefineProperty(this,"Id",U,this),babelHelpers.initializerDefineProperty(this,"ConditionGroups",A,this),babelHelpers.initializerDefineProperty(this,"ElementsUsed",H,this)}LoadDefaultValues(){this.Id=0,this.Type="ShowHide",this.ElementsUsed=[],this.ConditionGroups=[]}},U=babelHelpers.applyDecoratedDescriptor(L.prototype,"Id",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),A=babelHelpers.applyDecoratedDescriptor(L.prototype,"ConditionGroups",[B],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),H=babelHelpers.applyDecoratedDescriptor(L.prototype,"ElementsUsed",[N],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),L);class K extends J{LoadDefaultValues(){super.LoadDefaultValues(),this.Type="ShowHide",this.ShowWhenTrue=!0}}class X extends J{LoadDefaultValues(){super.LoadDefaultValues(),this.Type="Validation",this.IsInvalidWhenTrue=!0,this.InvalidMessage="Invalid Field"}}var ee,te,ie,se,re;let ne=(ee=s.StoreAutoIncrement("FBRow"),te=s.StoreDataType(C),ie=class extends s.StoreBase{constructor(...e){super(...e),babelHelpers.initializerDefineProperty(this,"Id",se,this),babelHelpers.initializerDefineProperty(this,"Columns",re,this)}LoadDefaultValues(){this.Id=0,this.StepId=0,this.Columns=[]}},se=babelHelpers.applyDecoratedDescriptor(ie.prototype,"Id",[ee],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),re=babelHelpers.applyDecoratedDescriptor(ie.prototype,"Columns",[te],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ie);var le,ae,oe,ue,de,ce,he,pe,me,fe,be,ye,ge,Ie,Fe,Pe,Ce,ve,Se,xe,Oe,Te,we,Ee,De;let _e;!function(e){e.String="string",e.Price="price"}(_e||(_e={}));let Ge=(le=s.StoreDataType(Object),ae=class extends s.StoreBase{constructor(...e){super(...e),babelHelpers.initializerDefineProperty(this,"Ref",oe,this)}LoadDefaultValues(){this.ImageType="none",this.Ref=null}},oe=babelHelpers.applyDecoratedDescriptor(ae.prototype,"Ref",[le],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ae),Re=(ue=s.StoreAutoIncrement("MultipleStepItem"),de=s.StoreDataType(Number),ce=class extends s.StoreBase{constructor(...e){super(...e),babelHelpers.initializerDefineProperty(this,"Id",he,this),babelHelpers.initializerDefineProperty(this,"FieldIds",pe,this)}LoadDefaultValues(){this.Id=0,this.Title="",this.FieldIds=[],this.Icon=(new Ge).Merge()}},he=babelHelpers.applyDecoratedDescriptor(ce.prototype,"Id",[ue],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pe=babelHelpers.applyDecoratedDescriptor(ce.prototype,"FieldIds",[de],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ce),$e=(me=s.StoreDataType(Re),fe=class extends s.StoreBase{constructor(...e){super(...e),babelHelpers.initializerDefineProperty(this,"Steps",be,this)}LoadDefaultValues(){this.NextButtonText="Next",this.PreviousButtonText="Previous",this.SubmitButtonText="Submit",this.Steps=[]}},be=babelHelpers.applyDecoratedDescriptor(fe.prototype,"Steps",[me],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fe),Ve=(ye=s.StoreDataType(Object),ge=s.StoreDataType(Object),Ie=s.StoreDataType($e),Fe=s.StoreDataType(String),Pe=class extends s.StoreBase{constructor(...e){super(...e),babelHelpers.initializerDefineProperty(this,"Extensions",Ce,this),babelHelpers.initializerDefineProperty(this,"Icons",ve,this),babelHelpers.initializerDefineProperty(this,"MultipleSteps",Se,this),babelHelpers.initializerDefineProperty(this,"ExtensionsUsed",xe,this)}LoadDefaultValues(){this.Styles="",this.EnableDebug=!1,this.Icons=[],this.MapsApiKey="",this.MultipleSteps=null,this.Extensions=[],this.ExtensionsUsed=[]}},Ce=babelHelpers.applyDecoratedDescriptor(Pe.prototype,"Extensions",[ye],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ve=babelHelpers.applyDecoratedDescriptor(Pe.prototype,"Icons",[ge],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Se=babelHelpers.applyDecoratedDescriptor(Pe.prototype,"MultipleSteps",[Ie],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xe=babelHelpers.applyDecoratedDescriptor(Pe.prototype,"ExtensionsUsed",[Fe],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Pe),Me=(Oe=s.StoreDataType(ne),Te=s.StoreDataType(String),we=class extends s.StoreBase{constructor(...e){super(...e),babelHelpers.initializerDefineProperty(this,"Rows",Ee,this),babelHelpers.initializerDefineProperty(this,"Dependencies",De,this)}LoadDefaultValues(){this.Rows=[],this.ClientOptions=(new Ve).Merge(),this.Dependencies=[],this.RequiredMessage="Required"}},Ee=babelHelpers.applyDecoratedDescriptor(we.prototype,"Rows",[Oe],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),De=babelHelpers.applyDecoratedDescriptor(we.prototype,"Dependencies",[Te],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),we);var ze,Be,Ne,Le,Ue,Ae,He,ke,Qe,We,qe,je,Ye,Ze,Je,Ke;let Xe,et=(ze=s.StoreDataType(Number),Be=s.StoreDataType(Object),Ne=class extends s.StoreBase{constructor(...e){super(...e),babelHelpers.initializerDefineProperty(this,"Fields",Le,this),babelHelpers.initializerDefineProperty(this,"Compiled",Ue,this)}LoadDefaultValues(){this.Code="",this.Name="",this.Compiled=null,this.PreferredReturnType=_e.Price,this.Fields=[]}},Le=babelHelpers.applyDecoratedDescriptor(Ne.prototype,"Fields",[ze],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ue=babelHelpers.applyDecoratedDescriptor(Ne.prototype,"Compiled",[Be],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ne);!function(e){e.Text="text",e.Numeric="numeric",e.Total="total",e.TextArea="textarea",e.Radio="radio",e.Checkbox="checkbox",e.DropDown="dropdown",e.Hidden="hidden",e.Paragraph="paragraph",e.FileUpload="fileupload",e.ImagePicker="imagepicker",e.Divider="divider",e.Repeater="repeater",e.List="list",e.GroupPanel="grouppanel",e.FloatPanel="floatpanel",e.RepeaterItem="repeater_item",e.SubmitButton="submit_button",e.Datepicker="datepicker",e.DateRange="daterange",e.Masked="masked",e.ColorPicker="colorpicker",e.Slider="slider",e.ButtonSelection="buttonselection",e.Switch="switch",e.Signature="signature",e.ColorSwatcher="colorswatcher",e.TermOfService="termofservice",e.GoogleMaps="googlemaps",e.TextualImage="textualimage",e.Name="name",e.Email="email",e.Address="address",e.Recaptcha="recaptcha",e.None="none",e.Image="image",e.ActionButton="actionbutton",e.Survey="survey",e.HTML="html",e.SimpleText="simpletext"}(Xe||(Xe={}));let tt,it=(Ae=s.StoreAutoIncrement("FieldId"),He=s.StoreDataType(Object),ke=s.StoreDataType(Object),Qe=s.StoreDataType(et),We=s.StoreDataType(J),qe=class extends s.StoreBase{constructor(...e){super(...e),babelHelpers.initializerDefineProperty(this,"Id",je,this),babelHelpers.initializerDefineProperty(this,"Description",Ye,this),babelHelpers.initializerDefineProperty(this,"Tooltip",Ze,this),babelHelpers.initializerDefineProperty(this,"Formulas",Je,this),babelHelpers.initializerDefineProperty(this,"Conditions",Ke,this)}LoadDefaultValues(){this.Id=0,this.Label="",this.Description=null,this.Required=!1,this.Tooltip=null,this.IsFieldContainer=!1,this.Formulas=[],this.Conditions=[]}GetValueFromLoader(e,t){switch(e){case"Conditions":return class{static GetConditions(e){let t=[];for(let i of e)switch(i.Type){case"ShowHide":t.push((new K).Merge(i));break;case"Validation":t.push((new X).Merge(i))}return t}}.GetConditions(t);default:return null}}},je=babelHelpers.applyDecoratedDescriptor(qe.prototype,"Id",[Ae],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ye=babelHelpers.applyDecoratedDescriptor(qe.prototype,"Description",[He],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ze=babelHelpers.applyDecoratedDescriptor(qe.prototype,"Tooltip",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Je=babelHelpers.applyDecoratedDescriptor(qe.prototype,"Formulas",[Qe],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ke=babelHelpers.applyDecoratedDescriptor(qe.prototype,"Conditions",[We],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qe);!function(e){e.price_per_distance="price_per_distance",e.fixed_amount="fixed_amount",e.quantity="quantity",e.current_value="current_value",e.percent_of_original_price="percent_of_original_price",e.percent_or_original_price_plus_options="percent_or_original_price_plus_options",e.price_per_word="price_per_word",e.price_per_char="price_per_char",e.none="none",e.options="options",e.survey_options="survey_options",e.price_per_item="price_per_item",e.sum_of_fields_in_group="sum_of_fields_in_group",e.price_per_day="price_per_day",e.formula="formula",e.quantity_per_day="quantity_per_day"}(tt||(tt={}));class st extends it{constructor(...e){super(...e),this.QuantityMinimumValue=0,this.QuantityMaximumValue=0,this.QuantityDefaultValue="",this.QuantityPlaceholder="",this.QuantityLabel=""}LoadDefaultValues(){super.LoadDefaultValues(),this.PriceType=tt.none,this.Price="",this.SalePrice="",this.HidePrice=!1,this.ShowQuantitySelector=!1,this.QuantityPosition="top",this.QuantityMinimumValue=0,this.QuantityMaximumValue=0,this.QuantityDefaultValue="",this.QuantityPlaceholder="",this.QuantityLabel=""}}class rt{constructor(e){this.FormBuilder=e,this.UnitPrice=0,this.Quantity=0,this.OptionsTotal=0,this.TotalUpdated=new a.SingleEvent,this.GrandTotal=0,this.OptionsTotal=0,this.UnitPrice=0,this.FieldPriceUpdated=new a.SingleEvent,this.RecalculateTotal=this.RecalculateTotal.bind(this)}AddField(e){null!=e.Calculator&&(e.Calculator.PriceUpdated.Subscribe(this,this.RecalculateTotal),this.FieldPriceUpdated.Publish(e),this.RecalculateTotal(e))}RemoveField(e){null!=e.Calculator&&(e.Calculator.PriceUpdated.Unsubscribe(this),this.RecalculateTotal(e))}RecalculateTotal(e){null!=e&&this.FieldPriceUpdated.Publish(e);let t=this.GrandTotal,i=this.Quantity;this.UnitPrice=this.GetFields().reduce(((e,t)=>{var i;return e+(null===(i=t.Calculator)||void 0===i?void 0:i.GetPrice())}),0),this.Quantity=this.GetFields().reduce(((e,t)=>{var i;return Math.max(null===(i=t.Calculator)||void 0===i?void 0:i.GetQuantity(),e)}),0),this.GetFields().some((e=>e.Options.PriceType==tt.quantity||e.Options.PriceType==tt.quantity_per_day||e.Options.Type==Xe.FloatPanel))||(this.Quantity=1),this.GrandTotal=this.UnitPrice*this.Quantity,t==this.GrandTotal&&this.Quantity==i||(this.TotalUpdated.Publish(this.GrandTotal),null!=this.FormBuilder.Calculator&&this.FormBuilder.Calculator.PriceUpdated.Publish(this))}GetFields(){return this.FormBuilder.GetFields(!1,!1,!1).filter((e=>e.IsFieldWithPrice))}GetPriceIgnoringFields(e){let t=0;for(let i of this.GetFields())i.Calculator.IsDynamic()||e.find((e=>e.Options.Id==i.Options.Id))||(t+=i.Calculator.GetPrice());return t}GetPrice(e){let t=this.GetFields().find((t=>t==e));return null==t?0:t.Calculator.GetPrice()}GetUnitPrice(){return this.UnitPrice}GetOptionsTotal(){return this.OptionsTotal}GetGrandTotal(){return this.GrandTotal}}var nt,lt,at,ot;const ut=e=>{window.emitLitDebugLogEvents&&window.dispatchEvent(new CustomEvent("lit-debug",{detail:e}))};let dt;null!==(nt=globalThis.litIssuedWarnings)&&void 0!==nt||(globalThis.litIssuedWarnings=new Set),dt=(e,t)=>{t+=e?` See https://lit.dev/msg/${e} for more information.`:"",globalThis.litIssuedWarnings.has(t)||(console.warn(t),globalThis.litIssuedWarnings.add(t))},dt("dev-mode","Lit is in dev mode. Not recommended for production!");const ct=(null===(lt=window.ShadyDOM)||void 0===lt?void 0:lt.inUse)&&!0===(null===(at=window.ShadyDOM)||void 0===at?void 0:at.noPatch)?window.ShadyDOM.wrap:e=>e,ht=globalThis.trustedTypes,pt=ht?ht.createPolicy("lit-html",{createHTML:e=>e}):void 0,mt=e=>e,ft=(e,t,i)=>mt,bt=(e,t,i)=>Mt(e,t,i),yt="$lit$",gt=`lit$${String(Math.random()).slice(9)}$`,It="?"+gt,Ft=`<${It}>`,Pt=document,Ct=(e="")=>Pt.createComment(e),vt=e=>null===e||"object"!=typeof e&&"function"!=typeof e,St=Array.isArray,xt=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,Ot=/-->/g,Tt=/>/g,wt=new RegExp(">|[ \t\n\f\r](?:([^\\s\"'>=/]+)([ \t\n\f\r]*=[ \t\n\f\r]*(?:[^ \t\n\f\r\"'`<>=]|(\"|')|))|$)","g"),Et=/'/g,Dt=/"/g,_t=/^(?:script|style|textarea|title)$/i,Gt=Symbol.for("lit-noChange"),Rt=Symbol.for("lit-nothing"),$t=new WeakMap,Vt=Pt.createTreeWalker(Pt,129,null,!1);let Mt=ft;class zt{constructor({strings:e,_$litType$:t},i){let s;this.parts=[];let r=0,n=0;const l=e.length-1,a=this.parts,[o,u]=((e,t)=>{const i=e.length-1,s=[];let r,n=2===t?"<svg>":"",l=xt;for(let t=0;t<i;t++){const i=e[t];let a,o,u=-1,d=0;for(;d<i.length&&(l.lastIndex=d,o=l.exec(i),null!==o);)if(d=l.lastIndex,l===xt){if("!--"===o[1])l=Ot;else if(void 0!==o[1])l=Tt;else if(void 0!==o[2])_t.test(o[2])&&(r=new RegExp(`</${o[2]}`,"g")),l=wt;else if(void 0!==o[3])throw new Error("Bindings in tag names are not supported. Please use static templates instead. See https://lit.dev/docs/templates/expressions/#static-expressions")}else l===wt?">"===o[0]?(l=null!=r?r:xt,u=-1):void 0===o[1]?u=-2:(u=l.lastIndex-o[2].length,a=o[1],l=void 0===o[3]?wt:'"'===o[3]?Dt:Et):l===Dt||l===Et?l=wt:l===Ot||l===Tt?l=xt:(l=wt,r=void 0);console.assert(-1===u||l===wt||l===Et||l===Dt,"unexpected parse state B");const c=l===wt&&e[t+1].startsWith("/>")?" ":"";n+=l===xt?i+Ft:u>=0?(s.push(a),i.slice(0,u)+yt+i.slice(u)+gt+c):i+gt+(-2===u?(s.push(void 0),t):c)}const a=n+(e[i]||"<?>")+(2===t?"</svg>":"");if(!Array.isArray(e)||!e.hasOwnProperty("raw")){let e="invalid template strings array";throw e=" Internal Error: expected template strings to be an array with a 'raw' field. Faking a template strings array by calling html or svg like an ordinary function is effectively the same as calling unsafeHtml and can lead to major security issues, e.g. opening your code up to XSS attacks. If you're using the html or svg tagged template functions normally and and still seeing this error, please file a bug at https://github.com/lit/lit/issues/new?template=bug_report.md and include information about your build tooling, if any. ".trim().replace(/\n */g,"\n"),new Error(e)}return[void 0!==pt?pt.createHTML(a):a,s]})(e,t);if(this.el=zt.createElement(o,i),Vt.currentNode=this.el.content,2===t){const e=this.el.content,t=e.firstChild;t.remove(),e.append(...t.childNodes)}for(;null!==(s=Vt.nextNode())&&a.length<l;){if(1===s.nodeType){{const e=s.localName;if(/^(?:textarea|template)$/i.test(e)&&s.innerHTML.includes(gt)){const t=`Expressions are not supported inside \`${e}\` elements. See https://lit.dev/msg/expression-in-${e} for more information.`;if("template"===e)throw new Error(t);dt("",t)}}if(s.hasAttributes()){const e=[];for(const t of s.getAttributeNames())if(t.endsWith(yt)||t.startsWith(gt)){const i=u[n++];if(e.push(t),void 0!==i){const e=s.getAttribute(i.toLowerCase()+yt).split(gt),t=/([.?@])?(.*)/.exec(i);a.push({type:1,index:r,name:t[2],strings:e,ctor:"."===t[1]?At:"?"===t[1]?kt:"@"===t[1]?Qt:Ut})}else a.push({type:6,index:r})}for(const t of e)s.removeAttribute(t)}if(_t.test(s.tagName)){const e=s.textContent.split(gt),t=e.length-1;if(t>0){s.textContent=ht?ht.emptyScript:"";for(let i=0;i<t;i++)s.append(e[i],Ct()),Vt.nextNode(),a.push({type:2,index:++r});s.append(e[t],Ct())}}}else if(8===s.nodeType){if(s.data===It)a.push({type:2,index:r});else{let e=-1;for(;-1!==(e=s.data.indexOf(gt,e+1));)a.push({type:7,index:r}),e+=gt.length-1}}r++}null==ut||ut({kind:"template prep",template:this,clonableTemplate:this.el,parts:this.parts,strings:e})}static createElement(e,t){const i=Pt.createElement("template");return i.innerHTML=e,i}}function Bt(e,t,i=e,s){var r,n,l,a;if(t===Gt)return t;let o=void 0!==s?null===(r=i.__directives)||void 0===r?void 0:r[s]:i.__directive;const u=vt(t)?void 0:t._$litDirective$;return(null==o?void 0:o.constructor)!==u&&(null===(n=null==o?void 0:o._$notifyDirectiveConnectionChanged)||void 0===n||n.call(o,!1),void 0===u?o=void 0:(o=new u(e),o._$initialize(e,i,s)),void 0!==s?(null!==(l=(a=i).__directives)&&void 0!==l?l:a.__directives=[])[s]=o:i.__directive=o),void 0!==o&&(t=Bt(e,o._$resolve(e,t.values),o,s)),t}class Nt{constructor(e,t){this._parts=[],this._$disconnectableChildren=void 0,this._$template=e,this._$parent=t}get parentNode(){return this._$parent.parentNode}get _$isConnected(){return this._$parent._$isConnected}_clone(e){var t;const{el:{content:i},parts:s}=this._$template,r=(null!==(t=null==e?void 0:e.creationScope)&&void 0!==t?t:Pt).importNode(i,!0);Vt.currentNode=r;let n=Vt.nextNode(),l=0,a=0,o=s[0];for(;void 0!==o;){if(l===o.index){let t;2===o.type?t=new Lt(n,n.nextSibling,this,e):1===o.type?t=new o.ctor(n,o.name,o.strings,this,e):6===o.type&&(t=new Wt(n,this,e)),this._parts.push(t),o=s[++a]}l!==(null==o?void 0:o.index)&&(n=Vt.nextNode(),l++)}return r}_update(e){let t=0;for(const i of this._parts)void 0!==i&&(null==ut||ut({kind:"set part",part:i,value:e[t],valueIndex:t,values:e,templateInstance:this}),void 0!==i.strings?(i._$setValue(e,i,t),t+=i.strings.length-2):i._$setValue(e[t])),t++}}class Lt{constructor(e,t,i,s){var r;this.type=2,this._$committedValue=Rt,this._$disconnectableChildren=void 0,this._$startNode=e,this._$endNode=t,this._$parent=i,this.options=s,this.__isConnected=null===(r=null==s?void 0:s.isConnected)||void 0===r||r,this._textSanitizer=void 0}get _$isConnected(){var e,t;return null!==(t=null===(e=this._$parent)||void 0===e?void 0:e._$isConnected)&&void 0!==t?t:this.__isConnected}get parentNode(){let e=ct(this._$startNode).parentNode;const t=this._$parent;return void 0!==t&&11===e.nodeType&&(e=t.parentNode),e}get startNode(){return this._$startNode}get endNode(){return this._$endNode}_$setValue(e,t=this){if(null===this.parentNode)throw new Error("This `ChildPart` has no `parentNode` and therefore cannot accept a value. This likely means the element containing the part was manipulated in an unsupported way outside of Lit's control such that the part's marker nodes were ejected from DOM. For example, setting the element's `innerHTML` or `textContent` can do this.");e=Bt(this,e,t),vt(e)?e===Rt||null==e||""===e?(this._$committedValue!==Rt&&(null==ut||ut({kind:"commit nothing to child",start:this._$startNode,end:this._$endNode,parent:this._$parent,options:this.options}),this._$clear()),this._$committedValue=Rt):e!==this._$committedValue&&e!==Gt&&this._commitText(e):void 0!==e._$litType$?this._commitTemplateResult(e):void 0!==e.nodeType?this._commitNode(e):(e=>{var t;return St(e)||"function"==typeof(null===(t=e)||void 0===t?void 0:t[Symbol.iterator])})(e)?this._commitIterable(e):this._commitText(e)}_insert(e,t=this._$endNode){return ct(ct(this._$startNode).parentNode).insertBefore(e,t)}_commitNode(e){var t;if(this._$committedValue!==e){if(this._$clear(),Mt!==ft){const e=null===(t=this._$startNode.parentNode)||void 0===t?void 0:t.nodeName;if("STYLE"===e||"SCRIPT"===e){let t="Forbidden";throw t="STYLE"===e?"Lit does not support binding inside style nodes. This is a security risk, as style injection attacks can exfiltrate data and spoof UIs. Consider instead using css`...` literals to compose styles, and make do dynamic styling with css custom properties, ::parts, <slot>s, and by mutating the DOM rather than stylesheets.":"Lit does not support binding inside script nodes. This is a security risk, as it could allow arbitrary code execution.",new Error(t)}}null==ut||ut({kind:"commit node",start:this._$startNode,parent:this._$parent,value:e,options:this.options}),this._$committedValue=this._insert(e)}}_commitText(e){if(this._$committedValue!==Rt&&vt(this._$committedValue)){const t=ct(this._$startNode).nextSibling;void 0===this._textSanitizer&&(this._textSanitizer=bt(t,"data","property")),e=this._textSanitizer(e),null==ut||ut({kind:"commit text",node:t,value:e,options:this.options}),t.data=e}else{const t=document.createTextNode("");this._commitNode(t),void 0===this._textSanitizer&&(this._textSanitizer=bt(t,"data","property")),e=this._textSanitizer(e),null==ut||ut({kind:"commit text",node:t,value:e,options:this.options}),t.data=e}this._$committedValue=e}_commitTemplateResult(e){var t;const{values:i,_$litType$:s}=e,r="number"==typeof s?this._$getTemplate(e):(void 0===s.el&&(s.el=zt.createElement(s.h,this.options)),s);if((null===(t=this._$committedValue)||void 0===t?void 0:t._$template)===r)null==ut||ut({kind:"template updating",template:r,instance:this._$committedValue,parts:this._$committedValue._parts,options:this.options,values:i}),this._$committedValue._update(i);else{const e=new Nt(r,this),t=e._clone(this.options);null==ut||ut({kind:"template instantiated",template:r,instance:e,parts:e._parts,options:this.options,fragment:t,values:i}),e._update(i),null==ut||ut({kind:"template instantiated and updated",template:r,instance:e,parts:e._parts,options:this.options,fragment:t,values:i}),this._commitNode(t),this._$committedValue=e}}_$getTemplate(e){let t=$t.get(e.strings);return void 0===t&&$t.set(e.strings,t=new zt(e)),t}_commitIterable(e){St(this._$committedValue)||(this._$committedValue=[],this._$clear());const t=this._$committedValue;let i,s=0;for(const r of e)s===t.length?t.push(i=new Lt(this._insert(Ct()),this._insert(Ct()),this,this.options)):i=t[s],i._$setValue(r),s++;s<t.length&&(this._$clear(i&&ct(i._$endNode).nextSibling,s),t.length=s)}_$clear(e=ct(this._$startNode).nextSibling,t){var i;for(null===(i=this._$notifyConnectionChanged)||void 0===i||i.call(this,!1,!0,t);e&&e!==this._$endNode;){const t=ct(e).nextSibling;ct(e).remove(),e=t}}setConnected(e){var t;if(void 0!==this._$parent)throw new Error("part.setConnected() may only be called on a RootPart returned from render().");this.__isConnected=e,null===(t=this._$notifyConnectionChanged)||void 0===t||t.call(this,e)}}class Ut{constructor(e,t,i,s,r){this.type=1,this._$committedValue=Rt,this._$disconnectableChildren=void 0,this.element=e,this.name=t,this._$parent=s,this.options=r,i.length>2||""!==i[0]||""!==i[1]?(this._$committedValue=new Array(i.length-1).fill(new String),this.strings=i):this._$committedValue=Rt,this._sanitizer=void 0}get tagName(){return this.element.tagName}get _$isConnected(){return this._$parent._$isConnected}_$setValue(e,t=this,i,s){const r=this.strings;let n=!1;if(void 0===r)e=Bt(this,e,t,0),n=!vt(e)||e!==this._$committedValue&&e!==Gt,n&&(this._$committedValue=e);else{const s=e;let l,a;for(e=r[0],l=0;l<r.length-1;l++)a=Bt(this,s[i+l],t,l),a===Gt&&(a=this._$committedValue[l]),n||(n=!vt(a)||a!==this._$committedValue[l]),a===Rt?e=Rt:e!==Rt&&(e+=(null!=a?a:"")+r[l+1]),this._$committedValue[l]=a}n&&!s&&this._commitValue(e)}_commitValue(e){e===Rt?ct(this.element).removeAttribute(this.name):(void 0===this._sanitizer&&(this._sanitizer=Mt(this.element,this.name)),e=this._sanitizer(null!=e?e:""),null==ut||ut({kind:"commit attribute",element:this.element,name:this.name,value:e,options:this.options}),ct(this.element).setAttribute(this.name,null!=e?e:""))}}class At extends Ut{constructor(){super(...arguments),this.type=3}_commitValue(e){void 0===this._sanitizer&&(this._sanitizer=Mt(this.element,this.name)),e=this._sanitizer(e),null==ut||ut({kind:"commit property",element:this.element,name:this.name,value:e,options:this.options}),this.element[this.name]=e===Rt?void 0:e}}const Ht=ht?ht.emptyScript:"";class kt extends Ut{constructor(){super(...arguments),this.type=4}_commitValue(e){null==ut||ut({kind:"commit boolean attribute",element:this.element,name:this.name,value:!(!e||e===Rt),options:this.options}),e&&e!==Rt?ct(this.element).setAttribute(this.name,Ht):ct(this.element).removeAttribute(this.name)}}class Qt extends Ut{constructor(e,t,i,s,r){if(super(e,t,i,s,r),this.type=5,void 0!==this.strings)throw new Error(`A \`<${e.localName}>\` has a \`@${t}=...\` listener with invalid content. Event listeners in templates must have exactly one expression and no surrounding text.`)}_$setValue(e,t=this){var i;if((e=null!==(i=Bt(this,e,t,0))&&void 0!==i?i:Rt)===Gt)return;const s=this._$committedValue,r=e===Rt&&s!==Rt||e.capture!==s.capture||e.once!==s.once||e.passive!==s.passive,n=e!==Rt&&(s===Rt||r);null==ut||ut({kind:"commit event listener",element:this.element,name:this.name,value:e,options:this.options,removeListener:r,addListener:n,oldListener:s}),r&&this.element.removeEventListener(this.name,this,s),n&&this.element.addEventListener(this.name,this,e),this._$committedValue=e}handleEvent(e){var t,i;"function"==typeof this._$committedValue?this._$committedValue.call(null!==(i=null===(t=this.options)||void 0===t?void 0:t.host)&&void 0!==i?i:this.element,e):this._$committedValue.handleEvent(e)}}class Wt{constructor(e,t,i){this.element=e,this.type=6,this._$disconnectableChildren=void 0,this._$parent=t,this.options=i}get _$isConnected(){return this._$parent._$isConnected}_$setValue(e){null==ut||ut({kind:"commit to element binding",element:this.element,value:e,options:this.options}),Bt(this,e)}}const qt=window.litHtmlPolyfillSupportDevMode;null==qt||qt(zt,Lt),(null!==(ot=globalThis.litHtmlVersions)&&void 0!==ot?ot:globalThis.litHtmlVersions=[]).push("2.2.3"),globalThis.litHtmlVersions.length>1&&dt("multiple-versions","Multiple versions of Lit loaded. Loading multiple versions is not recommended.");const jt=2,Yt=e=>(...t)=>({_$litDirective$:e,values:t});class Zt{constructor(e){}get _$isConnected(){return this._$parent._$isConnected}_$initialize(e,t,i){this.__part=e,this._$parent=t,this.__attributeIndex=i}_$resolve(e,t){return this.update(e,t)}update(e,t){return this.render(...t)}}class Jt extends Zt{constructor(e){if(super(e),this._value=Rt,e.type!==jt)throw new Error(`${this.constructor.directiveName}() can only be used in child bindings`)}render(e){if(e===Rt||null==e)return this._templateResult=void 0,this._value=e;if(e===Gt)return e;if("string"!=typeof e)throw new Error(`${this.constructor.directiveName}() called with a non-string value`);if(e===this._value)return this._templateResult;this._value=e;const t=[e];return t.raw=t,this._templateResult={_$litType$:this.constructor.resultType,strings:t,values:[]}}}Jt.directiveName="unsafeHTML",Jt.resultType=1;const Kt=Yt(Jt);var Xt={};!function(e){Object.defineProperty(e,"__esModule",{value:!0});var t="check",i=[],s="f00c",r="M173.898 439.404l-166.4-166.4c-9.997-9.997-9.997-26.206 0-36.204l36.203-36.204c9.997-9.998 26.207-9.998 36.204 0L192 312.69 432.095 72.596c9.997-9.997 26.207-9.997 36.204 0l36.203 36.204c9.997 9.997 9.997 26.206 0 36.204l-294.4 294.401c-9.998 9.997-26.207 9.997-36.204-.001z";e.definition={prefix:"fas",iconName:t,icon:[512,512,i,s,r]},e.faCheck=e.definition,e.prefix="fas",e.iconName=t,e.width=512,e.height=512,e.ligatures=i,e.unicode=s,e.svgPathData=r}(Xt),u.customElement("rn-result-dialog-content")(class extends d.LitElementBase{constructor(...e){super(...e),this.iconType="Success",this.buttonText="Done"}static get properties(){return{content:{type:Object},title:{type:String}}}render(){let e="success";return"Error"==this.iconType&&(e="danger"),"Warning"==this.iconType&&(e="warning"),i.html` <div> <div style="text-align: center" class="ResultDialogIcon"> ${c.rnIf("Success"==this.iconType&&i.html` <div class="svg-box"> <svg class="circular green-stroke"> <circle class="path" cx="75" cy="75" r="50" fill="none" stroke-width="5px" stroke-miterlimit="10"/> </svg> <svg class="checkmark green-stroke"> <g transform="matrix(0.79961,8.65821e-32,8.39584e-32,0.79961,-489.57,-205.679)"> <path class="checkmark__check" fill="none" d="M616.306,283.025L634.087,300.805L673.361,261.53"/> </g> </svg> </div>`)} ${c.rnIf("Error"==this.iconType&&i.html` <div class="svg-box"> <svg class="circular red-stroke"> <circle class="path" cx="75" cy="75" r="50" fill="none" stroke-width="5px" stroke-miterlimit="10"/> </svg> <svg class="cross red-stroke"> <g transform="matrix(0.79961,8.65821e-32,8.39584e-32,0.79961,-502.652,-204.518)"> <path class="first-line" d="M634.087,300.805L673.361,261.53" fill="none"/> </g> <g transform="matrix(-1.28587e-16,-0.79961,0.79961,-1.28587e-16,-204.752,543.031)"> <path class="second-line" d="M634.087,300.805L673.361,261.53"/> </g> </svg> </div>`)} ${c.rnIf("Warning"==this.iconType&&i.html` <div class="svg-box"> <svg class="circular yellow-stroke"> <circle class="path" cx="75" cy="75" r="50" fill="none" stroke-width="5px" stroke-miterlimit="10"/> </svg> <svg class="alert-sign yellow-stroke"> <g transform="matrix(1,0,0,1,-615.516,-257.346)"> <g transform="matrix(0.56541,-0.56541,0.56541,0.56541,93.7153,495.69)"> <path class="line" d="M634.087,300.805L673.361,261.53" fill="none"/> </g> <g transform="matrix(2.27612,-2.46519e-32,0,2.27612,-792.339,-404.147)"> <circle class="dot" cx="621.52" cy="316.126" r="1.318"/> </g> </g> </svg> </div>`)} </div> ${null!=this.title&&i.html` <p class=${"ResultDialogTitle"} style="white-space: pre-wrap">${this.title}</p> `} ${c.rnIf(null!=this.content&&"string"==typeof this.content&&i.html` <div style="text-align: left;margin-top: 15px;max-height: 300px;overflow: auto" class="ResultDialogContent"> ${Kt(this.content)} </div> `)} ${c.rnIf(null!=this.content&&"string"!=typeof this.content&&i.html` <div style="margin-top: 15px;max-height: 300px;overflow: auto" class="ResultDialogContent"> ${this.content} </div> `)} <div style="text-align: center;margin-top: 15px"> <button @click=${e=>{e.preventDefault(),this.FireEvent("accepted",null)}} class="rnbtn rnbtn-${e}" style="padding: 10px 34px; display: inline-flex;align-items: center;"> <rn-fontawesome .icon=${Xt.faCheck} style="display: inline-flex"></rn-fontawesome> <span style="margin-left: 5px">${this.buttonText}</span></button> </div> </div> `}}),u.customElement("rn-result-dialog")(class extends o.DialogBase{constructor(...e){super(...e),this.iconType="Success",this.buttonText="Done"}InternalGetOptions(){}SubRender(){return i.html`<rn-result-dialog-content @accepted="${e=>this.SendResult(null)}" .iconType="${this.iconType}" .title="${this.title}" .content="${this.content}" .buttonText=${this.buttonText}></rn-result-dialog-content>`}});class ei{constructor(e,t){this.Id=e,this.Message=t}}class ti{constructor(e){this.OriginalField=e,this.ChainMeta=[],this.Id=++ti.Id,this.ChainEnded=new a.SingleEvent}AddMeta(e,t,i=null){let s=this.ChainMeta.find((t=>t.key==e&&t.reference==i));null==s&&(s={key:e,reference:i,value:null},this.ChainMeta.push(s)),s.value=t}}ti.Id=0;class ii{constructor(e){this.FieldModel=e,this.AlreadyProcessedChains=[]}GetFormula(e){return this.FieldModel.Options.Formulas.find((t=>t.Name==e))}ExecuteFormulaIfExist(e,t=null){let i=this.GetFormula(e);null!=i&&this.ExecuteCalculation(i,t)}UpdateOrCreateFormula(e,t,i,s){let r=this.GetFormula(e);null==r?this.FieldModel.Options.Formulas.push((new et).Merge({Name:e,Code:t,Compiled:i,PreferredReturnType:s})):(r.Code=t,r.Compiled=i,r.PreferredReturnType=s)}HasFormula(e){return null!=this.GetFormula(e)}RemoveFormula(e){let t=this.FieldModel.Options.Formulas.find((t=>t.Name==e));null!=t&&this.FieldModel.Options.Formulas.splice(this.FieldModel.Options.Formulas.indexOf(t),1)}StartListener(){for(let e of this.FieldModel.Options.Formulas){for(let t of e.Fields){let i=this.FieldModel.FormBuilder.GetFieldById(t,!1,!0);if(null==i)return void alert(`Invalid formula for field ${this.FieldModel.Options.Label+" (Id:"+this.FieldModel.Options.Id}), field with id ${t} does not exist`);i.ValueChanged.Subscribe([this,e.Name],(t=>{this.ExecuteCalculation(e,t)}))}this.ExecuteCalculation(e,new ti(this.FieldModel))}}ExecuteCalculation(e,t=null){if(null!=t&&this.AlreadyProcessedChains.some((e=>e==t.Id)))return;let i=r.EventManager.Publish("CalculateFormula",{FieldList:this.FieldModel.FormBuilder.GetFields(!1,!0,!0),Formula:e,Owner:this.FieldModel,Chain:t});null!=t&&this.AlreadyProcessedChains.push(t.Id),void 0!==this.FieldModel["Set"+e.Name]&&this.FieldModel["Set"+e.Name](i,t)}GetFriendlyFormula(e){var t;let i=null===(t=this.GetFormula(e))||void 0===t?void 0:t.Code;if(null==i)return"";let s,r=/\$Field ([^$]*)\$/;for(;s=r.exec(i);){let e=s[1],t=s[0],r=this.FieldModel.FormBuilder.GetFieldById(e,!0,!0);if(null==r)i=i.replace(t,`[Unknown field ${e}]`);else{let e=r.Options.Label;""==e.trim()&&(e="Id:"+r.Options.Id),e.length>15&&(e=e.substr(0,15)+"..."),i=i.replace(t,`[${e}]`)}}for(r=/\$Fixed ([^$]*)\$/,s=null;s=r.exec(i);){let e=s[1],t=s[0];try{let s=e.substr(1,e.length-2).replace(/\\"/g,'"');s=JSON.parse(s),i=i.replace(t,`[${s.Label}]`)}catch(e){}}return i}}class si{constructor(e){this.fieldContainer=e}Compare(e,t){return!!t.GetIsVisible()&&this.InternalCompare(e,t)}GetStringValue(e,t){return""==e.PathId?t.ToText():this.GetValueByPath(e.PathId,t)}GetValue(e,t){return""==e.PathId?t.GetValue():this.GetValueByPath(e.PathId,t)}GetValueByPath(e,t){let i=t.GetValue();return null==i||null==i[e]?null:i[e]}}class ri extends si{InternalCompare(e,t){let i=h.Sanitizer.SanitizeString(e.Value),s=h.Sanitizer.SanitizeString(this.GetStringValue(e,t),"");switch(e.Comparison){case k.Equal:return i==s;case k.NotEqual:return i!=s;case k.IsEmpty:return""==s;case k.IsNotEmpty:return""!=s;case k.Contains:return s.toLocaleLowerCase().indexOf(i.toLocaleLowerCase())>=0;case k.NotContains:return s.toLocaleLowerCase().indexOf(i.toLocaleLowerCase())<0}}}class ni extends si{InternalCompare(e,t){let i=h.Sanitizer.SanitizeNumber(e.Value,null),s=h.Sanitizer.SanitizeNumber(this.GetStringValue(e,t),0);if(null===i||null===s)return!1;switch(e.Comparison){case k.Equal:return i==s;case k.NotEqual:return i!=s;case k.IsEmpty:return""==this.GetStringValue(e,t);case k.IsNotEmpty:return""!=this.GetStringValue(e,t);case k.GreaterThan:return s>i;case k.GreaterOrEqualThan:return s>=i;case k.LessThan:return s<i;case k.LessOrEqualThan:return s<=i}}}class li extends si{InternalCompare(e,t){let i=h.Sanitizer.SanitizeStringArray(e.Value),s=h.Sanitizer.SanitizeStringArray(this.GetValue(e,t));switch(e.Comparison){case k.Contains:return s.some((e=>i.indexOf(e)>=0));case k.NotContains:return!s.some((e=>i.indexOf(e)>=0));case k.IsEmpty:return 0==s.length;case k.IsNotEmpty:return s.length>0}}}let ai;!function(e){e[e.None=0]="None",e[e.FalseFirst=1]="FalseFirst",e[e.TrueFirst=2]="TrueFirst"}(ai||(ai={}));class oi{constructor(e){this.Id=e,this.SubscribedCallBacks=[]}}class ui{constructor(){this.LastResult=null}GetExecuteOnFieldChange(){return!0}GetExecuteOnInitialize(){return!0}GetExecutionOrder(){return ai.None}async Initialize(e,t,i=null){if(this.FieldContainer=e,this.Condition=t,this.LastResult=null,this.GetExecuteOnFieldChange())for(let e of t.ElementsUsed)if(e.Type==q.Field){let t=this.FieldContainer.GetFieldById(e.Id,!1,!0);null!=t&&t.ValueChanged.Subscribe(this,(e=>{this.ExecuteCondition(),e.ChainEnded.Subscribe(this,(()=>this.ConditionProcessingEnded()))}))}if(this.GetExecuteOnInitialize()){let e=!1;null==i&&(e=!0,i=new ti(null)),await this.ExecuteCondition(!0,null),e&&i.ChainEnded.Publish()}return this}GetUniqueId(){return""}async ExecuteCondition(e=!1,t=null){let i=await this.ProcessCondition();if(this.GetExecutionOrder()==ai.None){if(this.LastResult===i)return;this.LastResult=i,null!=t&&t.AddMeta(this.GetUniqueId()+"_"+(i?"TrueExecuted":"FalseExecuted"),!0),i?this.ExecuteTruAction(e):this.ExecuteFalseAction(e)}else{let s=this.GetUniqueId(),r=ui.ExecutionDictionary.find((e=>e.Id==s));null==r&&(r=new oi(s),ui.ExecutionDictionary.push(r),t.ChainEnded.Subscribe(this,(()=>{let e=e=>{null!=t&&t.AddMeta(this.GetUniqueId()+"_"+(i?"TrueExecuted":"FalseExecuted"),!0),e.Callback(),e.ConditionProcessor.LastResult=e.ResultType};this.GetExecutionOrder()==ai.FalseFirst?(r.SubscribedCallBacks.filter((e=>0==e.ResultType)).forEach(e),r.SubscribedCallBacks.filter((e=>1==e.ResultType)).forEach(e)):(r.SubscribedCallBacks.filter((e=>1==e.ResultType)).forEach(e),r.SubscribedCallBacks.filter((e=>0==e.ResultType)).forEach(e)),ui.ExecutionDictionary.indexOf(r)>=0&&ui.ExecutionDictionary.splice(ui.ExecutionDictionary.indexOf(r),1)}))),i?r.SubscribedCallBacks.push({ResultType:!0,Callback:()=>this.ExecuteTruAction(e),ConditionProcessor:this}):r.SubscribedCallBacks.push({ResultType:!1,Callback:()=>this.ExecuteFalseAction(e),ConditionProcessor:this})}return i}async ProcessCondition(){for(let e of this.Condition.ConditionGroups){let t=!0;for(let i of e.ConditionLines){if(!t)break;let e=null;switch(i.Type){case W.Field:e=this.FieldContainer.GetFieldById(i.FieldId,!1,!0);break;case W.Entry:e=!0}if(null==e)return!1;switch(i.SubType){case Q.Text:case"Standard":t=new ri(this.FieldContainer).Compare(i,e);break;case Q.Numeric:t=new ni(this.FieldContainer).Compare(i,e);break;case Q.MultipleValues:t=new li(this.FieldContainer).Compare(i,e);break;default:let s=r.EventManager.Publish("GetRunnableComparator",{SubType:i.SubType,Container:this.FieldContainer});if(null==s)throw new Error("Invalid comparison "+i.SubType);t=s.Compare(i,e)}}if(t)return!0}return!1}ConditionProcessingEnded(){}}ui.ExecutionDictionary=[];class di extends ui{async Initialize(e,t,i=null){throw Error("Invalid initialization, please use initialize with fields instead")}async InitializeWidthFields(e,t){return this.Field=e,super.Initialize(e.FormBuilder,t)}}class ci extends di{ExecuteFalseAction(e){this.Condition.ShowWhenTrue?this.Field.Hide(e):this.Field.Show(e)}ExecuteTruAction(e){this.Condition.ShowWhenTrue?this.Field.Show(e):this.Field.Hide(e)}}class hi extends di{GetExecuteOnFieldChange(){return!1}GetExecuteOnInitialize(){return!1}ExecuteFalseAction(e){this.Condition.IsInvalidWhenTrue?this.Field.RemoveError("Validation_"+this.Condition.Id):this.Field.AddError("Validation_"+this.Condition.Id,this.Condition.InvalidMessage)}ExecuteTruAction(e){this.Condition.IsInvalidWhenTrue?this.Field.AddError("Validation_"+this.Condition.Id,this.Condition.InvalidMessage):this.Field.RemoveError("Validation_"+this.Condition.Id)}}class pi extends t.ModelWithParent{constructor(e,t){super(e,t),this.IsVisible=!0,this.IsFieldContainer=!1,this.IsFieldWithPrice=!1,this.IsPriceField=!1,this.Errors=[],this.ImmediateAnimation=!0,this.IsFocused=!1,this.ValueChanged=new a.SingleEvent,this.FormulaManager=new ii(this),this.Conditions=[]}get IsHiddenTypeOfField(){return!1}get RootFormBuilder(){return this.Parent.RootFormBuilder}get FormBuilder(){var e;return null===(e=this.Parent)||void 0===e?void 0:e.FormBuilder}async Initialize(e=null){return this.InitializeStartingValues(e),this}GetStoresInformation(){return!0}get IsDesign(){var e;return null==this.Parent||(null===(e=this.RootFormBuilder)||void 0===e?void 0:e.IsDesign)}InitializeFormulas(){null==this.Parent||this.IsDesign||this.FormulaManager.StartListener()}async InitializeConditions(){this.InitializeFormulas();for(let e of this.Options.Conditions)switch(e.Type){case"ShowHide":this.Conditions.push(await(new ci).InitializeWidthFields(this,e));break;case"Validation":this.Conditions.push(await(new hi).InitializeWidthFields(this,e))}}get IsReadonly(){var e,t;return null==this.FormBuilder||!1===(null===(e=this.RootFormBuilder.AdditionalOptions)||void 0===e||null===(t=e.EditOptions)||void 0===t?void 0:t.AllowEdition)}GetIsValid(){return!this.GetIsVisible()||0==this.Errors.length}RemoveError(e){let t=this.Errors.find((t=>t.Id==e));null!=t&&(this.Errors.splice(this.Errors.indexOf(t),1),this.Refresh())}GetIsUsed(){return this.GetIsVisible()&&this.GetIsValid()}GetIsVisible(){return this.IsVisible}get Row(){return this.Parent.Parent}get Column(){return this.Parent}Focus(){this.IsFocused=!0,this.Refresh()}UnFocus(){this.IsFocused=!1,this.Refresh()}Show(e=!1){var t;0==this.IsVisible&&(this.ImmediateAnimation=e,this.IsVisible=!0,this.FireValueChanged(),null===(t=this.Parent)||void 0===t||t.Refresh())}Hide(e=!1){var t;1==this.IsVisible&&(this.ImmediateAnimation=e,this.IsVisible=!1,this.FireValueChanged(),null===(t=this.Parent)||void 0===t||t.Refresh())}GetAdditionalClasses(){return[]}FireValueChanged(e=null){var t;let i=e;null==e&&(e=new ti(this)),this.GetIsUsed()&&this.RemoveError("required"),null===(t=this.FormBuilder)||void 0===t||t.FieldValueChanged.Publish(this),this.ValueChanged.Publish(e),null==i&&e.ChainEnded.Publish(e),this.Refresh()}GetPrice(){return 0}ToText(){return""}GetPriceWithoutFormula(){return 0}AddError(e,t){this.Errors.some((t=>t.Id==e))||(this.Errors.push(new ei(e,t)),this.Refresh())}async Validate(){if(this.RemoveError("required"),!this.GetIsValid())return!0;this.Options.Required&&!this.GetIsUsed()&&this.AddError("required",this.RootFormBuilder.Options.RequiredMessage);for(let e of this.Conditions.filter((e=>"Validation"==e.Condition.Type)))await e.ExecuteCondition();return this.GetIsValid()}ScrollToField(){if(null==this.Instance)return;let e=this.Instance.getBoundingClientRect();(e.top<0||e.top>document.documentElement.clientHeight)&&class{static ScrollTo(e,t){var i=e.scrollTop,s=t-i,r=0,n=function(){var t,l,a,o=(t=r+=20,l=i,a=s,(t/=100)<1?a/2*t*t+l:-a/2*(--t*(t-2)-1)+l);e.scrollTop=o,r<200&&setTimeout(n,20)};n()}}.ScrollTo(document.documentElement,document.documentElement.scrollTop+e.top-50)}SerializeEntry(){let e={Label:this.Options.Label,Id:this.Options.Id,Type:this.Options.Type};return this.InternalSerialize(e),e}GetValue(){return null}GetNumericalValue(){let e=this.GetValue();return isNaN(e)?0:parseFloat(e)}GetPreviousData(){if(null==this.FormBuilder)return null;let e=this.FormBuilder.PreviousData;return null==e||null==e.Fields?null:e.Fields.find((e=>e.Id==this.Options.Id))}GetPreviousDataProperty(e,t){let i=this.GetPreviousData();if(null==i)return t;if(""==e)return i;let s=e.split(","),r=i;for(let e of s){if(void 0===r[e])return t;r=r[e]}return r}GetFixedValue(e){return""}}class mi{constructor(e){this.FormBuilder=e,this.UnitPrice=0,this.Quantity=0,this.OptionsTotal=0,this.TotalUpdated=new a.SingleEvent,this.GrandTotal=0,this.OptionsTotal=0,this.UnitPrice=0,this.FieldPriceUpdated=new a.SingleEvent,this.RecalculateTotal=this.RecalculateTotal.bind(this)}AddField(e){null!=e.Calculator&&(e.Calculator.PriceUpdated.Subscribe(this,this.RecalculateTotal),this.FieldPriceUpdated.Publish(e),this.RecalculateTotal(e))}RemoveField(e){null!=e.Calculator&&(e.Calculator.PriceUpdated.Unsubscribe(this),this.RecalculateTotal(e))}RecalculateTotal(e){null!=e&&this.FieldPriceUpdated.Publish(e);let t=this.GrandTotal,i=this.Quantity;this.UnitPrice=this.GetFields().reduce(((e,t)=>{var i;return e+(null===(i=t.Calculator)||void 0===i?void 0:i.GetPrice())}),0),this.Quantity=this.GetFields().reduce(((e,t)=>{var i;return Math.max(null===(i=t.Calculator)||void 0===i?void 0:i.GetQuantity(),e)}),0),this.GetFields().some((e=>e.Options.PriceType==tt.quantity||e.Options.PriceType==tt.quantity_per_day||e.Options.Type==Xe.FloatPanel))||(this.Quantity=1),this.GrandTotal=this.UnitPrice*this.Quantity,t==this.GrandTotal&&this.Quantity==i||(this.TotalUpdated.Publish(this.GrandTotal),null!=this.FormBuilder.Calculator&&this.FormBuilder.Calculator.PriceUpdated.Publish(this))}GetFields(){return this.FormBuilder.GetFields(!1,!1,!1).filter((e=>e.IsFieldWithPrice))}GetPriceIgnoringFields(e){let t=0;for(let i of this.GetFields())i.Calculator.IsDynamic()||e.find((e=>e.Options.Id==i.Options.Id))||(t+=i.Calculator.GetPrice());return t}GetPrice(e){let t=this.GetFields().find((t=>t==e));return null==t?0:t.Calculator.GetPrice()}GetUnitPrice(){return this.UnitPrice}GetOptionsTotal(){return this.OptionsTotal}GetGrandTotal(){return this.GrandTotal}}function fi(t){var i,s,n;return i=e.ModelSerialize(),s=class extends t{constructor(...e){super(...e),babelHelpers.initializerDefineProperty(this,"Rows",n,this),this.IsFieldContainer=!0,this.Rows=[],this.FieldValueChanged=new a.SingleEvent,this.PriceManager=new mi(this)}GetId(){return this.Options.Id}get RootFormBuilder(){return null==this.Parent?this:this.Parent.RootFormBuilder}get FormBuilder(){return null==this.Parent||null==this.Parent.FormBuilder?null:this.Parent.FormBuilder}GetFields(e=!1,t=!1,i=!0){let s=[];for(let t of this.Rows)for(let r of t.Columns){let t=r.Field;if(s.push(t),(t.Options.Type==Xe.GroupPanel||t.Options.Type==Xe.FloatPanel)&&i)for(let e of t.GetFields(!1,!1,!0))s.push(e);if(e&&(t.Options.Type==Xe.Repeater||t.Options.Type==Xe.RepeaterItem))for(let e of t.GetFields(!0))s.push(e)}return t&&null!=this.FormBuilder&&(s=s.concat(this.FormBuilder.GetFields(!1,!0).filter((e=>!s.some((t=>e.Options.Id==t.Options.Id)))))),s}GetFieldById(e,t=!1,i=!1,s=!1){for(let i of this.GetFields(!1,!1,!1)){if(i.Options.Id==e)return i;if((t||s)&&1==i.IsFieldContainer&&(i=i.GetFieldById(e,t,!1,s),null!=i))return i}return i&&null!=this.FormBuilder?this.FormBuilder.GetFieldById(e,!1,!0):null}CreateFieldOptions(e){let t=e;null!=e.Type&&(t=e.Type);let i=r.EventManager.Publish("GetFieldOptions",t);if(null==i)throw Error("Field options type not found "+t);return i.Merge(null!=e.Id?e:null),i}CreateFieldModel(e){let t=r.EventManager.Publish("GetFieldModel",{Options:e,Parent:null});if(null==t)throw new Error("Model type not found "+e.Type);return t}CreateFieldOptionsAndModel(e){let t=this.CreateFieldOptions(e);return this.CreateFieldModel(t)}CreateRow(e,t=null,i=0){let s=new O((new ne).Merge(e),this);return s.Options.StepId=i,null!==t&&this.InsertRow(s,t),s}ExecuteFirstCalculation(){this.GetFields(!1,!1,!1).forEach((e=>{if(1==e.IsFieldWithPrice){null!=e.ExecuteFirstCalculation&&e.ExecuteFirstCalculation();let t=e;if(null==t.Calculator)return;t.Calculator.GetDependsOnOtherFields()||t.Calculator.ExecuteAndUpdate(),t.Calculator.GetDependsOnOtherFields()&&t.Calculator.ExecuteAndUpdate()}}))}InsertRow(e,t){this.Rows.splice(t,0,e)}async Validate(){let e=!0;this.LastFieldWithErrors=null;let t=[];for(let i of this.GetFields(!1,!1,!1)){let s=await i.Validate();s instanceof Promise?t.push({Promise:s,Field:i}):s||(e=!1,null==this.LastFieldWithErrors&&(this.LastFieldWithErrors=i))}if(!e)return!1;for(let i of t)await i.Promise||(e=!1,null==this.LastFieldWithErrors&&(this.LastFieldWithErrors=i.Field));return e}async Initialize(){return this instanceof pi&&this.InitializeStartingValues(this.PreviousData),this.GetFields(!1,!1,!1).forEach((async e=>await e.Initialize(this.PreviousData))),this.RootFormBuilder.IsDesign||(this.GetFields(!1,!1,!1).forEach((async e=>await e.InitializeConditions())),this instanceof pi&&await this.InitializeConditions()),this.GetFields().forEach((e=>{e.IsFieldWithPrice&&e.Options.PriceType!=tt.none&&this.PriceManager.AddField(e)})),this}},n=babelHelpers.applyDecoratedDescriptor(s.prototype,"Rows",[i],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),s}class bi extends(fi(e.ModelBase)){constructor(e,t,i={}){super(t),this.FormId=e,this.IsLoaded=!1,this.InternalId=1,this.EntryId="",this.ReferenceId="",this.RunnableAddOns=[],this.AdditionalOptions=i,this.OnLoad=new a.SingleEvent;for(let e of t.Rows)this.Rows.push(new O(e,this));null!=i.PreviousData&&(this.PreviousData=i.PreviousData,void 0!==i.PreviousData.EntryId&&(this.EntryId=i.PreviousData.EntryId),void 0!==i.PreviousData.ReferenceId&&(this.ReferenceId=i.PreviousData.ReferenceId),this.Status=i.PreviousData.Status)}render(){return i.html`<rn-form-builder .model="${this}"></rn-form-builder>`}SetAddOns(e){this.RunnableAddOns=e}GetIcon(e){return this.Options.ClientOptions.Icons.find((t=>t.Name==e))}set HideSubmitButton(e){null!=this.AdditionalOptions&&(this.AdditionalOptions.HideSubmitButton=e,this.Refresh())}get HideSubmitButton(){var e;return!0===(null===(e=this.AdditionalOptions)||void 0===e?void 0:e.HideSubmitButton)}async Initialize(){return this.ExecuteAddOnMethod("BeforeInit"),await super.Initialize(),r.EventManager.Publish("LoadExtensionOptions",{Model:this}),this.ExecuteAddOnMethod("AfterInit"),this.InitializeFormModel(),this}ExecuteAddOnMethod(e,t=null){this.RunnableAddOns.forEach((i=>i[e].apply(i,t)))}get IsDesign(){return!1}get IsEntry(){return!1}GetHTML(e){return r.EventManager.Publish("GetHTML",{HTML:e,FormBuilder:this})}async Save(){let e={Entry:{}};e.Entry.FormId=this.AdditionalOptions.FormId,e.Entry.Data=[];try{if(!await this.Validate())return void this.LastFieldWithErrors.ScrollToField()}catch(e){return}for(let t of this.GetFields(!1,!1,!1))t.GetStoresInformation()&&t.GetIsUsed()&&e.Entry.Data.push(t.SerializeEntry());e.Entry.Total=this.PriceManager.GetGrandTotal(),e.Entry.Status=this.Status,e.Entry.FormId=this.AdditionalOptions.FormId;let t={};for(let e of this.GetFields(!0,!1,!0)){if(null==e.GetFiles)continue;e.GetFiles().forEach((e=>t[e.Id]=e.File))}let s="form_submitted";var r;this.IsEdition()&&(s="entry_edited",e.EntryId=this.EntryId,e.ReferenceId=this.ReferenceId,e.Nonce=null===(r=this.PreviousData)||void 0===r?void 0:r.EditNonce);for(let i of this.RunnableAddOns){if(0==await i.BeforeSubmit(s,e,t))return}if(!this.AdditionalOptions.QuickPreview)return await this.SubmitForm(s,e,t);n.Dialog.Show(i.html`<rn-result-dialog .iconType="${"Error"}" .title="${this.AdditionalOptions.QuickPreviewTitle}" .content="${this.AdditionalOptions.QuickPreviewMessage}" .buttonText=${RNTranslate("Done")}></rn-result-dialog>`)}async SubmitForm(e,t,s){let r=await l.WpAjaxPost.Post(e,t,"",s,{OnError:(e,t)=>{let s=e;1==this.Options.ClientOptions.EnableDebug&&(s=i.html`<div> <span>${e}</span> <span style="display: block;text-align: left;font-weight: bold;margin-top: 30px">Additional Details</span> <code style="width: 100%;overflow: auto;height: 200px;display: block;text-align: left;border: 1px solid #dfdfdf;"> ${null==t?void 0:t.detail} </code> </div>`),n.Dialog.Show(i.html`<rn-result-dialog .iconType="${"Error"}" .title="${RNTranslate("Sorry, an error occurred")}" .content="${s}" .buttonText="${RNTranslate("Done")}"></rn-result-dialog>`)}});return null!=r&&(await this.MaybeExecuteAConfirmation(r),this.IsEdition()?r.Entry:(null!=this.PreviousData&&(this.PreviousData.Data=[]),void this.ClearForm()))}async MaybeExecuteAConfirmation(e){if(null!=e.Action)switch(e.Action.Type){case"message":await n.Dialog.Show(i.html` <rn-result-dialog .content="${e.Action.Content}" .title="${e.Action.Title}" .buttonText="${e.Action.ButtonText}" .iconType="${e.Action.IconType}"></rn-result-dialog>`);break;case"redirect":return document.location.href=e.Action.URL,new Promise((e=>{}))}for(let t of this.RunnableAddOns){let i=t.ProcessConfirmation(e);if(null!==i)return i}}async ClearForm(){this.Rows=[],this.PriceManager=new rt(this);for(let e of this.Options.Rows)this.Rows.push(new O(e,this));await this.Initialize(),this.ExecuteFirstCalculation(),this.InternalId++,this.Refresh()}async InitializeFormModel(){null!=this.Options.ClientOptions.MultipleSteps?(this.MultipleStepsModel=r.EventManager.Publish("GetMultipleStepsModel",{Model:this}),await this.MultipleStepsModel.Initialize()):this.MultipleStepsModel=null}IsEdition(){return""!=this.EntryId&&""!=this.ReferenceId}RenderRows(e=null){return null==e&&(e=this.Rows),p.repeat(e,(e=>e.Options.Id),(e=>e.render()))}}var yi;let gi=u.customElement("rn-fbrow")(yi=class extends m.LitModel{get properties(){return{model:{type:Object}}}GetParentStyles(){return{width:"100%",display:"block"}}render(){return i.html` ${p.repeat(this.model.Columns,(e=>e.Options.Id),(e=>e.render()))} `}firstUpdated(e){super.firstUpdated(e),this.model.Instance=this}})||yi;var Ii;let Fi=u.customElement("rn-fbcolumn")(Ii=class extends m.LitModel{static get properties(){return{model:{type:Object}}}firstUpdated(e){super.firstUpdated(e),this.model.Instance=this}GetParentStyles(){return{width:this.model.Options.WidthPercentage+"%"}}disconnectedCallback(){super.disconnectedCallback(),this.model.Instance=this}render(){let e=!this.model.Field.IsVisible||this.model.Field.IsHiddenTypeOfField&&!this.model.RootFormBuilder.IsDesign;return this.style.display=e?"none":"inline-block",i.html` ${this.model.Field.render()} `}})||Ii;var Pi,Ci={};!function(e){Object.defineProperty(e,"__esModule",{value:!0});var t="question-circle",i=[],s="f059",r="M504 256c0 136.997-111.043 248-248 248S8 392.997 8 256C8 119.083 119.043 8 256 8s248 111.083 248 248zM262.655 90c-54.497 0-89.255 22.957-116.549 63.758-3.536 5.286-2.353 12.415 2.715 16.258l34.699 26.31c5.205 3.947 12.621 3.008 16.665-2.122 17.864-22.658 30.113-35.797 57.303-35.797 20.429 0 45.698 13.148 45.698 32.958 0 14.976-12.363 22.667-32.534 33.976C247.128 238.528 216 254.941 216 296v4c0 6.627 5.373 12 12 12h56c6.627 0 12-5.373 12-12v-1.333c0-28.462 83.186-29.647 83.186-106.667 0-58.002-60.165-102-116.531-102zM256 338c-25.365 0-46 20.635-46 46 0 25.364 20.635 46 46 46s46-20.636 46-46c0-25.365-20.635-46-46-46z";e.definition={prefix:"fas",iconName:t,icon:[512,512,i,s,r]},e.faQuestionCircle=e.definition,e.prefix="fas",e.iconName=t,e.width=512,e.height=512,e.ligatures=i,e.unicode=s,e.svgPathData=r}(Ci);class vi extends d.LitElementBase{static get properties(){return{model:{type:Object}}}GetParentStyles(){return{display:"block"}}disconnectedCallback(){this.model.OnRefresh.Unsubscribe(this),super.disconnectedCallback()}connectedCallback(){this.model.Instance=this,this.model.OnRefresh.Subscribe(this,(()=>this.forceUpdate())),super.connectedCallback()}render(){return this.GetWrapper(i.html` <div class=${this.model.GetAdditionalClasses().join(" ")+" rnField rnField_"+this.model.Options.Id+" rn"+this.model.Options.Type+" "+(this.model.GetIsValid()?"":"rnInvalid")+(this.model.IsFocused?" RNFocus":"")} > <div class="rnFieldAndLabel"> ${this.GetLabel()} <div class='rnFieldContainer'> ${this.SubRender()} </div> ${this.AfterField()} ${c.rnIf(!this.model.GetIsValid()&&i.html` <span class='rnValidationMessage'> ${this.model.Errors[0].Message} </span> `)} </div> ${c.rnIf(null!=this.model.Options.Description&&this.model.RootFormBuilder.GetHTML(this.model.Options.Description).Code)} </div> `)}GetLabel(e="",t=!1){let s=this.model.Options.Label;return""!=e&&(s=e),""!=s?i.html` <div class='rednaoLabel' style="margin-bottom: 5px;display: block;"> <label style="display: inline-block">${s} ${c.rnIf(null!=this.model.Options.Tooltip&&!t&&this.MaybeCreateTooltip())} ${c.rnIf(this.model.Options.Required&&i.html`<span class='rnRequiredInd'>*</span>`)} </label> </div> `:null}GetWrapper(e){return e}MaybeCreateTooltip(){let e=r.EventManager.Publish("GetHTML",{HTML:this.model.Options.Tooltip,FormBuilder:this.model.FormBuilder});return null==e.Code?null:i.html`<rn-tooltip .tooltip="${e.Code}" .content="${i.html`<rn-fontawesome .icon="${Ci.faQuestionCircle}"></rn-fontawesome>`}" class="rnTooltip" style="cursor:pointer"></rn-tooltip>`}AfterField(){return null}}let Si=u.customElement("rn-form-builder")(Pi=class extends m.LitModel{get properties(){return{model:{type:Object}}}GetParentStyles(){return{display:"inline-block"}}async firstUpdated(e){super.firstUpdated(e),await this.updateComplete,this.model.IsLoaded=!0,this.model.Instance=this.renderRoot,this.model.OnLoad.Publish()}render(){return i.html` ${p.repeat([1],(e=>this.model.InternalId),(e=>i.html` <div class="rednaoForm rednao" style="position: relative"> <style type='text/css'> ${this.model.Options.ClientOptions.Styles} </style> ${null!=this.model.MultipleStepsModel?this.model.MultipleStepsModel.RenderFormContainer():this.model.RenderRows()} </div> `))} `}})||Pi;var xi;u.customElement("rn-icon-displayer")(class extends d.LitElementBase{constructor(...e){super(...e),this.size=18}static get properties(){return{}}GetParentStyles(){return{display:"inline-flex"}}render(){if("icon"==this.icon.ImageType){let e=null;e=null!=this.formBuilder.RootFormBuilder?this.formBuilder.RootFormBuilder.GetIcon(this.icon.Ref.Name):e.Ref;let t=this.style.color;return""==t&&(t="black"),i.html` <div class='RNIconOrImage' style="display:inline-flex;align-items: center;justify-content: center; height:100%;color: ${t};top:0;left: 3px"> <rn-fontawesome .icon=${e}></rn-fontawesome> </div> `}if("image"==this.icon.ImageType)return i.html` <div style="width:100%;display:flex;align-items:center;justify-content:center;height:100%;color:white;font-size:18px"> <img style="width: ${this.size};height: ${this.size};" src=${this.icon.Ref.URL} alt={''}/> </div> `}});class Oi extends it{constructor(...e){super(...e),this.Hide=!1}LoadDefaultValues(){super.LoadDefaultValues(),this.Type=Xe.SubmitButton,this.Label="Submit",this.Icon=(new Ge).Merge(),this.Hide=!1}}class Ti extends pi{InitializeStartingValues(e){}get IsHiddenTypeOfField(){return this.RootFormBuilder.HideSubmitButton}GetStoresInformation(){return!1}render(){return i.html`<rn-submit-button .model="${this}"></rn-submit-button>`}InternalSerialize(e){}}r.EventManager.Subscribe("GetFieldOptions",(e=>{if(e==Xe.SubmitButton)return new Oi})),r.EventManager.Subscribe("GetFieldModel",(e=>{if(e.Options.Type==Xe.SubmitButton)return new Ti(e.Options,e.Parent)}));let wi=u.customElement("rn-submit-button")(xi=class extends vi{constructor(...e){super(...e),this.isBusy=!1}static get properties(){return{isBusy:{type:Boolean}}}SubRender(){return i.html` <rn-spinner-button .isBusy="${this.isBusy}" @click="${e=>this.Click()}" class="default" label="${this.model.Options.Label}" .icon="${c.rnIf("none"!=this.model.Options.Icon.ImageType&&i.html` <rn-icon-displayer style="margin-right: 3px" .icon="${this.model.Options.Icon}" .formBuilder="${this.model.RootFormBuilder}"></rn-icon-displayer> `)}" > </rn-spinner-button> `}GetLabel(e="",t=!1){return null}async Click(){this.isBusy=!0,await this.model.RootFormBuilder.Save(),this.isBusy=!1}})||xi;class Ei extends vi{AfterField(){return 0==this.model.GetPrice()||null==this.model.GetPrice()||this.model.Options.HidePrice||this.model.Options.PriceType==tt.none?null:i.html` <rn-price .amount="${this.model.GetPrice()}"></rn-price> `}}class Di{constructor(){this.PriceUpdated=new a.SingleEvent,this.Price=null,this.RegularPrice=null,this.Quantity=0,this.RequireInstanceToCalculate=!1,this.ExecuteCalculation=this.ExecuteCalculation.bind(this)}GetDependsOnOtherFields(){return!1}GetUnitPrice(){return this.UnitPrice}Destroy(){this.PriceUpdated.Unsubscribe(this),this.Field.ValueChanged.Unsubscribe(this)}Initialize(e){return this.InitializeFieldOnly(e),this}GetForceUpdateWhenFieldChange(){return!1}InitializeFieldOnly(e){return this.Field=e,this}async ExecuteAndUpdate(e=!1,t=!1,i=null){let s=this.ExecuteCalculation(null,null),r=!1;if(s instanceof Promise){try{s=await s}catch(e){return}r=!0}let n=this.UpdatePrice(s.RegularPrice,s.Quantity,e,t,i);return r&&this.Field.Refresh(),n}GetIsUsed(){return this.Field.GetIsUsed()}GetPrice(){return this.GetIsUsed()?this.Price:0}GetSelectedValues(){}SerializeItem(e){}GetQuantity(){return this.GetIsUsed()?Math.max(1,this.Quantity):0}IsDynamic(){return!1}GetRegularPrice(){return this.RegularPrice}UpdatePrice(e,t=0,i=!1,s=!1,r=null){let n=this.GetIsUsed(),l=this.Price,a=this.Quantity,o=""==e?0:e;if(this.Quantity=t,""===e)this.Price=0,this.Field.Quantity=t,this.UnitPrice=0;else{let i=h.Sanitizer.SanitizeNumber(e,0);this.Price=i*t,this.UnitPrice=this.Price,this.RegularPrice=i*t}if(i||this.GetQuantity()!=a||o!==l||n!=this.GetIsUsed())return this.PriceUpdated.Publish(this.Field),s||this.Field.FireValueChanged(),!0}}class _i extends Di{constructor(){super(),this.Quantity=null,this.CustomRegularPrice=null}SetQuantity(e){return this.Quantity=e,this}SetRegularPrice(e){return this.CustomRegularPrice=e,this}ExecuteCalculation(e){null==e&&(e=this.Field.GetValue());let t=null!=this.CustomRegularPrice?this.CustomRegularPrice:this.Field.Options.Price;return isNaN(e)&&e.length>0||!isNaN(e)&&e>0||this.Field.Options.Type==Xe.DateRange&&null!=e||this.Field.Options.Type==Xe.GoogleMaps&&null!=e||this.Field.Options.Type==Xe.TextualImage&&null!=e?{RegularPrice:t,Quantity:this.GetQuantity()}:{RegularPrice:"",Quantity:0}}ParseNumber(e){let t=parseFloat(e);return isNaN(t)?0:t}}class Gi extends Di{InternalInstanceUpdated(e){}ExecuteCalculation(){return{RegularPrice:"",SalePrice:"",Quantity:0}}}class Ri{constructor(){this.PriceUpdated=new a.SingleEvent,this.Price=null,this.RegularPrice=null,this.Quantity=0,this.RequireInstanceToCalculate=!1,this.ExecuteCalculation=this.ExecuteCalculation.bind(this)}GetDependsOnOtherFields(){return!1}GetUnitPrice(){return this.UnitPrice}Destroy(){this.PriceUpdated.Unsubscribe(this),this.Field.ValueChanged.Unsubscribe(this)}Initialize(e){return this.InitializeFieldOnly(e),this}GetForceUpdateWhenFieldChange(){return!1}InitializeFieldOnly(e){return this.Field=e,this}async ExecuteAndUpdate(e=!1,t=!1,i=null){let s=this.ExecuteCalculation(null,null),r=!1;if(s instanceof Promise){try{s=await s}catch(e){return}r=!0}let n=this.UpdatePrice(s.RegularPrice,s.Quantity,e,t,i);return r&&this.Field.Refresh(),n}GetIsUsed(){return this.Field.GetIsUsed()}GetPrice(){return this.GetIsUsed()?this.Price:0}GetSelectedValues(){}SerializeItem(e){}GetQuantity(){return this.GetIsUsed()?Math.max(1,this.Quantity):0}IsDynamic(){return!1}GetRegularPrice(){return this.RegularPrice}UpdatePrice(e,t=0,i=!1,s=!1,r=null){let n=this.GetIsUsed(),l=this.Price,a=this.Quantity,o=""==e?0:e;if(this.Quantity=t,""===e)this.Price=0,this.Field.Quantity=t,this.UnitPrice=0;else{let i=h.Sanitizer.SanitizeNumber(e,0);this.Price=i*t,this.UnitPrice=this.Price,this.RegularPrice=i*t}if(i||this.GetQuantity()!=a||o!==l||n!=this.GetIsUsed())return this.PriceUpdated.Publish(this.Field),s||this.Field.FireValueChanged(),!0}}class $i extends Ri{constructor(){super(),this.OptionsTotal=[]}InitializeFieldOnly(e){return super.InitializeFieldOnly(e),this.Field.FormBuilder.PriceManager.FieldPriceUpdated.Subscribe(this,(e=>{e!=this.Field&&this.Field.GetSelectedOptions()})),this}ExecuteCalculation(e){this.OptionsTotal=[];let t=this.Field.GetSelectedOptions();if(0==t.length)return{RegularPrice:"",SalePrice:"",Quantity:0};for(let e of t){let t=null;t=(new _i).InitializeFieldOnly(this.Field).SetRegularPrice(e.RegularPrice).SetQuantity(1).ExecuteCalculation("aa");let i={Id:e.Id,SalePrice:t.SalePrice,RegularPrice:t.RegularPrice,UnitPrice:""==t.SalePrice?t.RegularPrice:t.SalePrice,Quantity:1};""==i.UnitPrice?i.UnitPrice=0:i.UnitPrice=parseFloat(i.UnitPrice),isNaN(i.UnitPrice)&&(i.UnitPrice=0),i.Price=i.UnitPrice*i.Quantity,this.OptionsTotal.push(i)}let i={RegularPrice:0,SalePrice:0,Quantity:0};i.Quantity=this.GetQuantity();for(let e of this.OptionsTotal)this.OptionsTotal.some((e=>""!=e.SalePrice))?(i.SalePrice+=h.Sanitizer.SanitizeNumber(e.Price,0),i.RegularPrice+=h.Sanitizer.SanitizeNumber(e.RegularPrice,0)):(i.SalePrice=0,i.RegularPrice+=h.Sanitizer.SanitizeNumber(e.Price,0));return i}GetForceUpdateWhenFieldChange(){return!0}ParseNumber(e){let t=parseFloat(e);return isNaN(t)?0:t}InternalInstanceUpdated(e){}AddOption(e,t){return""!=t.RegularPrice&&(e.RegularPrice=h.Sanitizer.SanitizeNumber(e.RegularPrice,0)+h.Sanitizer.SanitizeNumber(t.RegularPrice,0)),""!=t.SalePrice&&(e.SalePrice=h.Sanitizer.SanitizeNumber(e.SalePrice,0)+h.Sanitizer.SanitizeNumber(t.SalePrice,0)),e}}class Vi extends pi{constructor(...e){super(...e),this.IsFieldWithPrice=!0,this.IsPriceField=!0}InitializePriceCalculator(){this.Calculator=class{static GetCalculator(e){switch(e){case tt.fixed_amount:return new _i;case tt.options:return new $i;case tt.none:return new Gi}let t=r.EventManager.Publish("GetCalculator",e);if(null==t)throw new Error("Calculator "+e+" not found");return t}}.GetCalculator(this.Options.PriceType),this.Calculator.Initialize(this)}async InitializeConditions(){null!=this.FormBuilder&&this.InitializePriceCalculator(),super.InitializeConditions()}GetPrice(){if(!this.GetIsValid())return 0;if(this.Options.PriceType==tt.none||this.RootFormBuilder.IsDesign){let e=parseFloat(this.ToText());return isNaN(e)?0:e}return this.Calculator.GetPrice()}FireValueChanged(e=null){return new Promise((t=>{let i=e;null==e&&(e=new ti(this)).ChainEnded.Subscribe(this,(e=>t())),null!=this.Calculator&&this.Calculator.ExecuteAndUpdate(this.Calculator.GetForceUpdateWhenFieldChange(),!0,e),super.FireValueChanged(e),null==i&&(e.ChainEnded.Publish(e),t())}))}SetPrice(e){this.GetIsUsed()||(e=0),e=h.Sanitizer.SanitizeNumber(e,0),this.Calculator.UpdatePrice(e,1)}InternalSerialize(e){if(e.PriceType=this.Options.PriceType,null==this.Calculator)return e.SalePrice=0,e.Quantity=0,void(e.UnitPrice=0);e.Price=this.Calculator.GetPrice(),e.Quantity=this.Calculator.GetQuantity(),e.UnitPrice=this.Calculator.GetUnitPrice()}}var Mi,zi,Bi,Ni,Li,Ui,Ai,Hi;class ki extends s.StoreBase{LoadDefaultValues(){this.Id=0,this.Value=""}}let Qi=(Mi=s.StoreDataType(ki),zi=class extends s.StoreBase{constructor(...e){super(...e),babelHelpers.initializerDefineProperty(this,"AdditionalOptionValue",Bi,this)}LoadDefaultValues(){this.Type="",this.Selected=!1,this.Id=0,this.Label="",this.RegularPrice="",this.AdditionalOptionValue=[]}},Bi=babelHelpers.applyDecoratedDescriptor(zi.prototype,"AdditionalOptionValue",[Mi],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zi),Wi=(Ni=s.StoreAutoIncrement("AdditionalOptionColumn"),Li=s.StoreDataType(Object),Ui=class extends s.StoreBase{constructor(...e){super(...e),babelHelpers.initializerDefineProperty(this,"Id",Ai,this),babelHelpers.initializerDefineProperty(this,"Options",Hi,this)}LoadDefaultValues(){this.Id=0,this.Label="",this.Options=null,this.Type=""}},Ai=babelHelpers.applyDecoratedDescriptor(Ui.prototype,"Id",[Ni],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Hi=babelHelpers.applyDecoratedDescriptor(Ui.prototype,"Options",[Li],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ui);var qi,ji,Yi,Zi,Ji;let Ki=(qi=s.StoreDataType(Qi),ji=s.StoreDataType(Wi),Yi=class extends st{constructor(...e){super(...e),babelHelpers.initializerDefineProperty(this,"Options",Zi,this),babelHelpers.initializerDefineProperty(this,"AdditionalOptionColumn",Ji,this)}LoadDefaultValues(){super.LoadDefaultValues(),this.Options=[],this.Options=[(new Qi).Merge({Id:1,RegularPrice:"",Label:"Option 1"}),(new Qi).Merge({Id:2,RegularPrice:"",Label:"Option 2"}),(new Qi).Merge({Id:3,RegularPrice:"",Label:"Option 3"})],this.AdditionalOptionColumn=[]}},Zi=babelHelpers.applyDecoratedDescriptor(Yi.prototype,"Options",[qi],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ji=babelHelpers.applyDecoratedDescriptor(Yi.prototype,"AdditionalOptionColumn",[ji],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Yi);class Xi{constructor(e){this.Options=e}static Initialize(e){Xi.WasInitialized=!0,window.RNPriceManager=new Xi(e)}static GetInstance(){return window.RNPriceManager}static FormatPrice(e){return Xi.GetInstance().InternalFormatPrice(e)}InternalFormatPrice(e){e=parseFloat(e),isNaN(e)&&(e=0);let t=e.toFixed(this.Options.Decimals);var i=t.split("."),s=i[0],r=i.length>1?"."+i[1]:"",n=/(\d+)(\d{3})/;if(""!=this.Options.ThousandSeparator)for(;n.test(s);)s=s.replace(n,"$1"+this.Options.ThousandSeparator+"$2");r.length>0&&(r=r.slice(1),r=this.Options.DecimalSeparator+r),t=s+r;let l=this.Options.Format.replace("%2$s",t);return l=l.replace("%1$s",this.Options.Symbol),l}}Xi.WasInitialized=!1,u.customElement("rn-price")(class extends d.LitElementBase{constructor(...e){super(...e),this.amount=0}static get properties(){return{amount:{type:Object}}}render(){return i.html` <span class=${"price rn-price "}> <span class='amount'> ${Kt(Xi.FormatPrice(this.amount))} </span> </span> `}});var es=Yt(class extends Zt{render(e){return i.noChange}update(e,t){if(0==t.length||null==t[0].ImageType)return i.noChange;let s=e.options.host.model;if(null==s)return i.noChange;let r=t[0],n=e.element;var l;if("none"==r.ImageType)return null===(l=n.parentElement.querySelector(".RNIconOrImage"))||void 0===l||l.remove(),i.noChange;let a=null;return a=i.renderInline(i.html` <rn-icon-displayer .icon="${r}" .formBuilder="${s.RootFormBuilder}"></rn-icon-displayer> `),a.style.position="absolute",a.style.left="3px",a.style.top=0,a.style.height="100%",n.style.paddingLeft="20px",n.parentElement.appendChild(a),i.noChange}});exports.FieldTypeEnum={},exports.FieldTypeEnum=Xe,exports.FieldWithPrice=Ei,exports.FieldWithPriceModel=Vi,exports.ConditionProcessorBase=ui,exports.PriceTypeEnum=tt,exports.IconDirective=es,exports.CalculatorBase=Ri,exports.PreferredReturnType={},exports.PreferredReturnTypeEnum=_e,exports.FormBuilderModel=bi,exports.FormBuilderOptions=Me,exports.FormBuilder=Si,exports.CurrencyManager=Xi,exports.FBRow=gi,exports.FBRowModel=O,exports.FBRowOptions=ne,exports.ElementUsedOptions=Z,exports.ElementUsedTypeEnum=q,exports.FBColumn=Fi,exports.FBColumnOptions=C,exports.FBColumnModel=g,exports.FieldBase=vi,exports.FieldBaseOptions=it,exports.FieldBaseModel=pi,exports.RunnableAddOnLoader=class{constructor(){r.EventManager.Subscribe("RegisterRunnableAddOn",(e=>{this.FormBuilder=e.FormBuilder,e.AddOns.push(this)}))}AfterInit(){}BeforeInit(){}async BeforeSubmit(e,t,i){return!0}ProcessConfirmation(e){return null}},exports.MultipleOptionsBaseModel=class extends Vi{constructor(...e){super(...e),this.SelectedValues=[]}SetSelection(e=null){Array.isArray(e)||(e=[]);let t=[];for(let i of e)i=h.Sanitizer.SanitizeNumber(i),this.Options.Options.some((e=>e.Id==i))&&t.push(i);this.SelectedValues=t,this.FireValueChanged()}IsOptionSelected(e){return this.SelectedValues.indexOf(e)>=0}GetPriceWithoutFormula(){let e=0;return this.GetSelectedOptions().forEach((t=>e+=h.Sanitizer.SanitizeNumber(t.RegularPrice))),e}get AllowMultiple(){return!0}GetColumnNumber(e){let t=this.GetSelectedOptions(),i=this.Options.AdditionalOptionColumn.find((t=>t.Id==e||t.Label==e));if(null==i)return null;let s=[];return t.forEach((e=>{let t=e.AdditionalOptionValue.find((e=>e.Id==i.Id));if(null!=t){let e=parseFloat(t.Value.toString());if(isNaN(e))return;s.push(e)}})),s}RecreateSelectedOptions(){this.SelectedValues=this.Options.Options.filter((e=>e.Selected)).map((e=>e.Id))}InternalSerialize(e){if(super.InternalSerialize(e),e.SelectedValues=this.GetSelectedOptions().map((e=>e.ToObject())),this.Calculator instanceof $i)for(let t=0;t<e.SelectedValues.length;t++){let i=this.Calculator.OptionsTotal.find((i=>i.Id==e.SelectedValues[t].Id));null==i&&(i={Id:e.SelectedValues[t].Id,Price:0,Quantity:0,RegularPrice:0,Total:0}),e.SelectedValues[t]=Object.assign(e.SelectedValues[t],i)}}GetStoresInformation(){return!0}GetSelectedOptions(){return this.OptionItemsToUse.filter((e=>this.SelectedValues.indexOf(e.Id)>=0))}GetIsUsed(){return!!super.GetIsUsed()&&this.SelectedValues.length>0}GetValue(){return this.GetIsVisible()?this.SelectedValues:[]}GetColumnValue(e){let t=this.GetSelectedOptions(),i=this.Options.AdditionalOptionColumn.find((t=>t.Id==e||t.Label==e));if(null==i)return null;let s=[];return t.forEach((e=>{let t=e.AdditionalOptionValue.find((e=>e.Id==i.Id));null!=t&&s.push(t.Value)})),0==s.length?null:s}GetText(){return this.GetSelectedOptions().map((e=>e.Label)).join(", ")}EnableOption(e){this.DisabledValues.indexOf(e)>=0&&this.DisabledValues.splice(this.DisabledValues.indexOf(e),1),this.Refresh()}IsOptionDisabled(e){return this.DisabledValues.indexOf(e)>=0}DisableOption(e){this.DisabledValues.indexOf(e)<0&&this.DisabledValues.push(e),this.SelectedValues.indexOf(e)>=0&&this.SelectedValues.splice(this.SelectedValues.indexOf(e),1),this.Refresh()}Contains(e){return null!=this.GetSelectedOptions().find((t=>t.Label==e))}SetOptionPrice(e,t=null){let i=this.Options.Options.find((t=>t.Id==e));if(null!=i){if(null===t){let i=this.OriginalOptionPrices.find((t=>t.Id==e));null!=i&&(t=i.Price)}i.RegularPrice=t.toString(),this.FireValueChanged()}}InitializeStartingValues(){this.OptionItemsToUse=this.Options.Options;let e=this.OptionItemsToUse.filter((e=>e.Selected)).map((e=>e.Id));if(null!=this.GetPreviousData()){let t=this.GetPreviousDataProperty("SelectedValues",[]);e=this.OptionItemsToUse.filter((e=>t.some((t=>t.Id==e.Id)))).map((e=>e.Id))}this.SelectedValues=e}ToggleSelection(e,t){void 0===t&&(t=!this.IsOptionSelected(e));let i=this.OptionItemsToUse.find((t=>t.Id==e));if(null==i){if(!this.AllowMultiple){let t=this.SelectedValues;if(this.SelectedValues=[],this.FireValueChanged(),1==t.length&&t[0]==e)return}return}let s=this.SelectedValues.slice(0);this.AllowMultiple||(s=[]),t&&-1==s.indexOf(i.Id)&&s.push(i.Id),!t&&s.indexOf(i.Id)>=0&&s.splice(s.indexOf(i.Id),1),s.length>0&&this.RemoveError("required"),this.SelectedValues=s,this.FireValueChanged()}get IsReadonly(){var e,t,i;return null==this.FormBuilder||!1===(null===(e=this.RootFormBuilder)||void 0===e||null===(t=e.AdditionalOptions)||void 0===t||null===(i=t.EditOptions)||void 0===i?void 0:i.AllowEdition)}},exports.MultipleOptionsBase=class extends Ei{},exports.MultipleOptionsBaseOptions=Ki,exports.ConditionBaseOptions=J,exports.ConditionLineTypeEnum=W,exports.ConditionLineOptions=j,exports.ConditionGroupOptions=Y,exports.IconOptions=Ge,exports.SubmitButton=wi,exports.SubmitButtonModel=Ti,exports.SubmitButtonOptions=Oi,exports.FieldWithPrice=Ei,exports.FieldWithPriceOptions=st,exports.FieldWithPriceModel=Vi,exports.ItemOptionsOptions={},exports.ItemOptionsOptions.ItemOptions=Qi,exports.ItemOptionsOptions.AdditionalColumnOptions=Wi,exports.ItemOptionsOptions.AdditionalOptionValue=ki,exports.FieldContainerMixin=fi,exports.SubTypeEnum=Q,exports.ComparisonTypeEnum=k,exports.RunnableComparatorBase=si,exports.ShowHideConditionOptions=K,exports.ValidationConditionOptions=X,exports.MultipleStepOptions=$e,exports.MultipleStepItem=Re}));
